<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Candid Labs Project Management - Projects, tasks, assignments, and status tracking.">
  <title>Projects - Candidlabs</title>
  <link rel="stylesheet" href="../styles.css">
  <link rel="stylesheet" href="projects.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
</head>
<body data-auth-require="true">
  <!-- Navigation - matches site-wide nav pattern -->
  <nav class="navbar" role="navigation" aria-label="Main navigation">
    <div class="container navbar-container">
      <a href="../index.html" class="logo" aria-label="Candidlabs home">candidlabs</a>

      <ul class="nav-menu" role="menubar">
        <li role="none"><a href="../crm/index.html" class="nav-link" role="menuitem">CRM</a></li>
        <li role="none"><a href="../prospecting/index.html" class="nav-link" role="menuitem">Prospecting</a></li>
        <li role="none"><a href="../projects/index.html" class="nav-link" role="menuitem">Projects</a></li>
        <li role="none"><a href="../reports.html" class="nav-link" role="menuitem">Reports</a></li>
        <li role="none" class="nav-dropdown">
              <button class="nav-link nav-dropdown-trigger" type="button" aria-expanded="false" aria-haspopup="true">Tools ▾</button>
              <ul class="nav-dropdown-menu">
                <li><a href="https://docs.google.com/forms/d/18dshhMSz7csbJBbeLg_fba6SAJMG5uyd3DnkW59rVSw/viewform" class="nav-dropdown-item" target="_blank" rel="noopener">KAA Form</a></li>
                <li><a href="https://docs.google.com/spreadsheets/d/19kDef25LdbvPssTkMusFGu8FmNbj2rWuF7NNF9SBSvs/edit" class="nav-dropdown-item" target="_blank" rel="noopener">Quote Generator</a></li>
                <li><a href="https://xero.me" class="nav-dropdown-item" target="_blank" rel="noopener">Submit Expenses</a></li>
              </ul>
            </li>
      </ul>

      <div class="nav-actions">
        <button
          id="theme-toggle"
          class="theme-toggle"
          type="button"
          aria-label="Switch to dark mode"
        >
          <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
          </svg>
          <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
            <circle cx="12" cy="12" r="5"></circle>
            <line x1="12" y1="1" x2="12" y2="3"></line>
            <line x1="12" y1="21" x2="12" y2="23"></line>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
            <line x1="1" y1="12" x2="3" y2="12"></line>
            <line x1="21" y1="12" x2="23" y2="12"></line>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
          </svg>
        </button>

        <a href="../login.html" class="btn btn-primary btn-login" aria-label="Login">Login</a>

        <button
          id="mobile-menu-toggle"
          class="mobile-menu-toggle"
          type="button"
          aria-label="Toggle navigation menu"
          aria-expanded="false"
          aria-controls="mobile-menu"
        >
          <span></span>
          <span></span>
          <span></span>
        </button>
      </div>
    </div>

    <!-- Mobile Menu -->
    <div id="mobile-menu" class="mobile-menu" role="menu" aria-label="Mobile navigation">
      <ul>
        <li><a href="../crm/index.html" role="menuitem">CRM</a></li>
        <li><a href="../prospecting/index.html" role="menuitem">Prospecting</a></li>
        <li><a href="../projects/index.html" role="menuitem">Projects</a></li>
        <li><a href="../reports.html" role="menuitem">Reports</a></li>
        <li><a href="https://docs.google.com/forms/d/18dshhMSz7csbJBbeLg_fba6SAJMG5uyd3DnkW59rVSw/viewform" role="menuitem" target="_blank" rel="noopener">KAA Form</a></li>
      <li><a href="https://docs.google.com/spreadsheets/d/19kDef25LdbvPssTkMusFGu8FmNbj2rWuF7NNF9SBSvs/edit" role="menuitem" target="_blank" rel="noopener">Quote Generator</a></li>
      <li><a href="https://xero.me" role="menuitem" target="_blank" rel="noopener">Submit Expenses</a></li>
        <li><a href="../login.html" role="menuitem">Login</a></li>
      </ul>
    </div>
  </nav>

  <main>
    <!-- Page Header -->
    <header class="page-header">
      <div class="container">
        <h1 class="page-title">Projects</h1>
        <p class="page-description">Project tracking, task management, and team assignments</p>
      </div>
    </header>

    <!-- Tool Layout: Sidebar + Content (matches budget.html / crm pattern) -->
    <section class="section" aria-label="Project Management Tool">
      <div class="container">
        <div class="tool-layout">

          <!-- Sidebar -->
          <aside class="tool-sidebar" aria-label="PM navigation">
            <div class="sidebar-section">
              <div class="sidebar-label">Modules</div>
              <button class="tool-btn active" data-tool="overview" onclick="switchTool('overview')">Overview</button>
              <button class="tool-btn" data-tool="projects" onclick="switchTool('projects')">Projects</button>
              <button class="tool-btn" data-tool="tasks" onclick="switchTool('tasks')">Tasks</button>
            </div>
          </aside>

          <!-- Content Area -->
          <div class="tool-content">

            <!-- OVERVIEW PANEL -->
            <div class="tool-panel active" id="tool-overview">
              <div class="tool-panel-header">
                <h2>Project Overview</h2>
                <p>Active projects and progress summary</p>
              </div>

              <div class="pm-stats">
                <div class="pm-stat-card">
                  <div class="pm-stat-number" id="stat-projects">0</div>
                  <div class="pm-stat-label">Active Projects</div>
                </div>
                <div class="pm-stat-card">
                  <div class="pm-stat-number" id="stat-tasks">0</div>
                  <div class="pm-stat-label">Total Tasks</div>
                </div>
                <div class="pm-stat-card">
                  <div class="pm-stat-number" id="stat-completed">0</div>
                  <div class="pm-stat-label">Completed</div>
                </div>
                <div class="pm-stat-card">
                  <div class="pm-stat-number" id="stat-overdue">0</div>
                  <div class="pm-stat-label">Overdue</div>
                </div>
              </div>

              <div id="project-cards" class="pm-project-cards"></div>
            </div>

            <!-- PROJECTS PANEL -->
            <div class="tool-panel" id="tool-projects">
              <div class="tool-panel-header">
                <h2>Projects</h2>
                <p>All projects with progress tracking</p>
              </div>

              <div class="pm-action-bar">
                <input type="text" class="pm-search" id="projects-search" placeholder="Search projects..." aria-label="Search projects">
                <button class="btn-add" onclick="openAddProject()">+ Add Project</button>
              </div>

              <div class="pm-table-container">
                <table class="pm-table">
                  <thead>
                    <tr>
                      <th>Project</th>
                      <th>Owner</th>
                      <th>Status</th>
                      <th>Progress</th>
                      <th>Due Date</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="projects-tbody"></tbody>
                </table>
              </div>
            </div>

            <!-- TASKS PANEL -->
            <div class="tool-panel" id="tool-tasks">
              <div class="tool-panel-header">
                <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;">
                  <div>
                    <h2>Tasks</h2>
                    <p>All tasks across projects</p>
                  </div>
                  <div class="pm-view-toggle">
                    <button class="pm-view-btn active" id="tasks-view-list" onclick="setTaskView('list')" title="List view">&#9776; List</button>
                    <button class="pm-view-btn" id="tasks-view-kanban" onclick="setTaskView('kanban')" title="Kanban view">&#9638; Board</button>
                  </div>
                </div>
              </div>

              <div id="tasks-list-view">
                <div class="pm-filter-tabs">
                  <button class="pm-filter-tab active" data-status="all" onclick="filterTasks('all')">All</button>
                  <button class="pm-filter-tab" data-status="to-do" onclick="filterTasks('to-do')">To Do</button>
                  <button class="pm-filter-tab" data-status="in-progress" onclick="filterTasks('in-progress')">In Progress</button>
                  <button class="pm-filter-tab" data-status="done" onclick="filterTasks('done')">Done</button>
                  <button class="pm-filter-tab" data-status="blocked" onclick="filterTasks('blocked')">Blocked</button>
                </div>

                <div class="pm-action-bar">
                  <input type="text" class="pm-search" id="tasks-search" placeholder="Search tasks..." aria-label="Search tasks">
                  <select class="pm-search" id="task-project-filter" aria-label="Filter by project" style="flex:0 0 auto; min-width:180px;" onchange="filterTasksByProject()">
                    <option value="all">All Projects</option>
                  </select>
                  <select class="pm-search" id="tasks-assignee-filter" aria-label="Filter by assignee" style="flex:0 0 auto; min-width:150px;" onchange="filterTasksByAssignee()">
                    <option value="all">All Assignees</option>
                  </select>
                  <button class="btn-add" onclick="openAddTask()">+ Add Task</button>
                </div>

                <div class="pm-table-container">
                  <table class="pm-table">
                    <thead>
                      <tr>
                        <th><button class="pm-sort-btn pm-tasks-sort-btn" data-col="title" onclick="sortTasks('title')">Task<span class="sort-arrow"></span></button></th>
                        <th>Project</th>
                        <th><button class="pm-sort-btn pm-tasks-sort-btn" data-col="assignee" onclick="sortTasks('assignee')">Assignee<span class="sort-arrow"></span></button></th>
                        <th><button class="pm-sort-btn pm-tasks-sort-btn" data-col="status" onclick="sortTasks('status')">Status<span class="sort-arrow"></span></button></th>
                        <th><button class="pm-sort-btn pm-tasks-sort-btn" data-col="priority" onclick="sortTasks('priority')">Priority<span class="sort-arrow"></span></button></th>
                        <th><button class="pm-sort-btn pm-tasks-sort-btn" data-col="dueDate" onclick="sortTasks('dueDate')">Due Date<span class="sort-arrow"></span></button></th>
                        <th>Actions</th>
                      </tr>
                    </thead>
                    <tbody id="tasks-tbody"></tbody>
                  </table>
                </div>
              </div>

              <!-- Kanban Board -->
              <div id="tasks-kanban-view" style="display:none;">
                <div class="pm-action-bar" style="margin-bottom:0;">
                  <select class="pm-search" id="kanban-project-filter" aria-label="Filter by project" style="flex:0 0 auto; min-width:180px;" onchange="renderTasksKanban()">
                    <option value="all">All Projects</option>
                  </select>
                  <button class="btn-add" onclick="openAddTask()">+ Add Task</button>
                </div>
                <div class="kanban-board" id="kanban-board"></div>
              </div>
            </div>

          </div><!-- /tool-content -->
        </div><!-- /tool-layout -->
      </div>
    </section>
  </main>

  <!-- PROJECT DRAWER -->
  <div class="pm-drawer-overlay" id="pm-drawer-overlay" onclick="closeProjectDrawer()"></div>
  <aside class="pm-drawer" id="pm-drawer" role="complementary" aria-label="Project details">
    <div class="pm-drawer-header">
      <div class="pm-drawer-header-left">
        <h3 id="drawer-project-name">Project</h3>
        <span class="pm-status" id="drawer-project-status"></span>
      </div>
      <div class="pm-drawer-header-right">
        <button class="btn-row-action" onclick="openEditProjectFromDrawer()">Edit</button>
        <button class="pm-drawer-close-btn" onclick="closeProjectDrawer()" aria-label="Close drawer">&#x2715;</button>
      </div>
    </div>

    <div class="pm-drawer-body">
      <!-- Description -->
      <p class="pm-drawer-description" id="drawer-description" style="display:none;"></p>

      <!-- Metrics -->
      <div class="pm-drawer-metrics">
        <div class="pm-drawer-metric">
          <div class="pm-drawer-metric-value" id="drawer-pct">—</div>
          <div class="pm-drawer-metric-label">Complete</div>
        </div>
        <div class="pm-drawer-metric">
          <div class="pm-drawer-metric-value" id="drawer-open-tasks">—</div>
          <div class="pm-drawer-metric-label">Open</div>
        </div>
        <div class="pm-drawer-metric">
          <div class="pm-drawer-metric-value" id="drawer-done-tasks">—</div>
          <div class="pm-drawer-metric-label">Done</div>
        </div>
        <div class="pm-drawer-metric">
          <div class="pm-drawer-metric-value" id="drawer-overdue-tasks">—</div>
          <div class="pm-drawer-metric-label">Overdue</div>
        </div>
      </div>
      <div class="pm-progress-bar" style="margin: 8px 0;">
        <div class="pm-progress-fill" id="drawer-progress-fill" style="width:0%"></div>
      </div>
      <div class="pm-drawer-meta">
        <span id="drawer-owner"></span>
        <span id="drawer-dates"></span>
      </div>

      <!-- Tasks section -->
      <div class="pm-drawer-section">
        <div class="pm-drawer-section-header">
          <span class="pm-drawer-section-title">TASKS</span>
          <span class="pm-drawer-section-count" id="drawer-tasks-count">0</span>
          <button class="pm-drawer-add-btn" onclick="openAddTaskForProject()">+ Add</button>
        </div>
        <div id="drawer-tasks-list"></div>
      </div>

      <!-- Notes section -->
      <div class="pm-drawer-section">
        <div class="pm-drawer-section-header">
          <span class="pm-drawer-section-title">NOTES</span>
          <span class="pm-drawer-section-count" id="drawer-notes-count">0</span>
        </div>
        <div id="drawer-notes-list"></div>
        <div class="pm-drawer-note-form">
          <textarea id="drawer-note-input" placeholder="Add a note or progress update..." rows="2"></textarea>
          <button class="btn-modal primary" style="width:100%;margin-top:6px;" onclick="saveDrawerNote()">Add Note</button>
        </div>
      </div>
    </div>
  </aside>

  <!-- MODALS -->

  <!-- Project Modal -->
  <div class="pm-modal-overlay" id="project-modal">
    <div class="pm-modal" role="dialog" aria-labelledby="project-modal-title">
      <h3 id="project-modal-title">Add Project</h3>
      <form id="project-form" onsubmit="event.preventDefault(); saveProject();">
        <input type="hidden" id="project-edit-id">
        <div class="pm-form-group">
          <label for="project-name">Project Name *</label>
          <input type="text" id="project-name" required>
        </div>
        <div class="pm-form-group">
          <label for="project-description">Description</label>
          <textarea id="project-description" placeholder="Project goals and scope..."></textarea>
        </div>
        <div class="pm-form-row">
          <div class="pm-form-group">
            <label for="project-owner">Owner</label>
            <input type="text" id="project-owner" placeholder="e.g. Dieter">
          </div>
          <div class="pm-form-group">
            <label for="project-status">Status</label>
            <select id="project-status">
              <option value="planning">Planning</option>
              <option value="active">Active</option>
              <option value="on-hold">On Hold</option>
              <option value="completed">Completed</option>
              <option value="cancelled">Cancelled</option>
            </select>
          </div>
        </div>
        <div class="pm-form-row">
          <div class="pm-form-group">
            <label for="project-start-date">Start Date</label>
            <input type="date" id="project-start-date">
          </div>
          <div class="pm-form-group">
            <label for="project-due-date">Due Date</label>
            <input type="date" id="project-due-date">
          </div>
        </div>
        <div class="pm-form-group">
          <label>Collaborators</label>
          <div id="project-collaborators" class="pm-collab-grid"></div>
        </div>
        <div class="pm-modal-actions">
          <button type="button" class="btn-modal secondary" onclick="pmCloseModal('project-modal')">Cancel</button>
          <button type="submit" class="btn-modal primary">Save Project</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Task Modal -->
  <div class="pm-modal-overlay" id="task-modal">
    <div class="pm-modal" role="dialog" aria-labelledby="task-modal-title">
      <h3 id="task-modal-title">Add Task</h3>
      <form id="task-form" onsubmit="event.preventDefault(); saveTask();">
        <input type="hidden" id="task-edit-id">
        <div class="pm-form-group">
          <label for="task-title">Task Title *</label>
          <input type="text" id="task-title" required>
        </div>
        <div class="pm-form-row">
          <div class="pm-form-group">
            <label for="task-project">Project</label>
            <select id="task-project">
              <option value="">-- Select Project --</option>
            </select>
          </div>
          <div class="pm-form-group">
            <label for="task-assignee">Assignee</label>
            <input type="text" id="task-assignee" placeholder="e.g. Dieter">
          </div>
        </div>
        <div class="pm-form-row">
          <div class="pm-form-group">
            <label for="task-task-status">Status</label>
            <select id="task-task-status">
              <option value="to-do">To Do</option>
              <option value="in-progress">In Progress</option>
              <option value="done">Done</option>
              <option value="blocked">Blocked</option>
            </select>
          </div>
          <div class="pm-form-group">
            <label for="task-priority">Priority</label>
            <select id="task-priority">
              <option value="high">High</option>
              <option value="medium" selected>Medium</option>
              <option value="low">Low</option>
            </select>
          </div>
        </div>
        <div class="pm-form-group">
          <label for="task-due-date">Due Date</label>
          <input type="date" id="task-due-date">
        </div>
        <div class="pm-form-group pm-blocker-note-group" id="task-blocker-note-group" style="display:none;">
          <label for="task-blocker-note">⚠ Blocker reason <span style="font-weight:400;color:var(--text-muted);font-size:0.8rem;">— what's stopping progress?</span></label>
          <textarea id="task-blocker-note" placeholder="e.g. Waiting on client sign-off / dependency on TSK-012..." style="min-height:70px;"></textarea>
          <div class="pm-blocker-actions" id="task-blocker-actions" style="display:none;margin-top:10px;">
            <label style="display:flex;align-items:center;gap:8px;font-size:0.85rem;cursor:pointer;">
              <input type="checkbox" id="task-blocker-create-followup"> Create a follow-up task for this blocker
            </label>
            <div id="task-blocker-followup-group" style="display:none;margin-top:8px;">
              <input type="text" id="task-blocker-followup-title" placeholder="Follow-up task title..." style="width:100%;padding:8px 10px;border:1px solid var(--border-color);border-radius:6px;background:var(--bg-primary);color:var(--text-primary);font-family:var(--font-body);font-size:0.875rem;">
            </div>
          </div>
        </div>
        <div class="pm-modal-actions">
          <button type="button" class="btn-modal secondary" onclick="pmCloseModal('task-modal')">Cancel</button>
          <button type="submit" class="btn-modal primary">Save Task</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Reassign Modal -->
  <div class="pm-modal-overlay" id="reassign-modal">
    <div class="pm-modal pm-modal-sm" role="dialog" aria-label="Reassign task">
      <h3>Reassign Task</h3>
      <input type="hidden" id="reassign-task-id">
      <p id="reassign-task-title" class="pm-modal-subtitle"></p>
      <div class="pm-form-group">
        <label for="reassign-assignee">Assign to</label>
        <input type="text" id="reassign-assignee" list="reassign-assignee-list" placeholder="Type or select a name..." autocomplete="off">
        <datalist id="reassign-assignee-list"></datalist>
      </div>
      <div class="pm-modal-actions">
        <button type="button" class="btn-modal secondary" onclick="pmCloseModal('reassign-modal')">Cancel</button>
        <button type="button" class="btn-modal primary" onclick="saveReassign()">Reassign</button>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <p class="footer-content">&copy; 2026 Candidlabs - Internal Use Only</p>
    </div>
  </footer>

  <!-- Auth: auto-bootstraps updateNavbar() + applyRoleVisibility() on DOMContentLoaded -->
  <script src="../auth.js"></script>
  <!-- script.js handles theme toggle + mobile menu (site-wide) -->
  <script src="../data-adapter.js"></script>
  <script src="../script.js"></script>
  <script src="projects.js"></script>
</body>
</html>
